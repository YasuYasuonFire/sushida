name: Auto Assign

on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]

jobs:
  auto-assign:
    runs-on: ubuntu-latest
    
    steps:
    - name: Auto assign issues and PRs
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo } = context.repo;
          
          // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ã‚µã‚¤ãƒ‹ãƒ¼ï¼ˆå®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã«å¤‰æ›´ã—ã¦ãã ã•ã„ï¼‰
          const defaultAssignees = ['your-username'];
          
          if (context.eventName === 'issues') {
            // Issueã®å ´åˆ
            const issue = context.payload.issue;
            
            // ãƒ©ãƒ™ãƒ«ã«åŸºã¥ãè‡ªå‹•ã‚¢ã‚µã‚¤ãƒ³
            const labels = issue.labels.map(label => label.name);
            let assignees = [];
            
            if (labels.includes('bug')) {
              assignees = defaultAssignees; // ãƒã‚°ã¯ä¸»è¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼ã«ã‚¢ã‚µã‚¤ãƒ³
            } else if (labels.includes('enhancement') || labels.includes('feature')) {
              assignees = defaultAssignees; // æ©Ÿèƒ½è¿½åŠ ã‚‚ä¸»è¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼ã«ã‚¢ã‚µã‚¤ãƒ³
            } else if (labels.includes('documentation')) {
              assignees = defaultAssignees; // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ä¸»è¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼ã«ã‚¢ã‚µã‚¤ãƒ³
            } else {
              assignees = defaultAssignees; // ãã®ä»–ã‚‚ä¸»è¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼ã«ã‚¢ã‚µã‚¤ãƒ³
            }
            
            if (assignees.length > 0) {
              await github.rest.issues.addAssignees({
                owner,
                repo,
                issue_number: issue.number,
                assignees
              });
            }
            
            // ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆåˆå›æŠ•ç¨¿è€…ã®å ´åˆï¼‰
            const { data: issuesData } = await github.rest.issues.listForRepo({
              owner,
              repo,
              creator: issue.user.login,
              state: 'all'
            });
            
            if (issuesData.length === 1) {
              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number: issue.number,
                body: `ğŸ‘‹ @${issue.user.login} ã•ã‚“ã€åˆå›ã®issueæŠ•ç¨¿ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\n\nã§ãã‚‹ã ã‘æ—©ãå¯¾å¿œã„ãŸã—ã¾ã™ã€‚è¿½åŠ æƒ…å ±ãŒå¿…è¦ãªå ´åˆã¯ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚\n\n---\n\nThank you for your first issue! We'll try to respond as soon as possible. Please let us know if you need to provide additional information.`
              });
            }
          } else if (context.eventName === 'pull_request') {
            // Pull Requestã®å ´åˆ
            const pr = context.payload.pull_request;
            
            // PRã®ã‚µã‚¤ã‚ºã«åŸºã¥ãè‡ªå‹•ãƒ©ãƒ™ãƒ«ä»˜ã‘
            const additions = pr.additions;
            const deletions = pr.deletions;
            const totalChanges = additions + deletions;
            
            let sizeLabel = '';
            if (totalChanges < 10) {
              sizeLabel = 'size/XS';
            } else if (totalChanges < 30) {
              sizeLabel = 'size/S';
            } else if (totalChanges < 100) {
              sizeLabel = 'size/M';
            } else if (totalChanges < 500) {
              sizeLabel = 'size/L';
            } else {
              sizeLabel = 'size/XL';
            }
            
            await github.rest.issues.addLabels({
              owner,
              repo,
              issue_number: pr.number,
              labels: [sizeLabel]
            });
            
            // ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã®è‡ªå‹•ã‚¢ã‚µã‚¤ãƒ³
            const reviewers = defaultAssignees.filter(user => user !== pr.user.login);
            if (reviewers.length > 0) {
              await github.rest.pulls.requestReviewers({
                owner,
                repo,
                pull_number: pr.number,
                reviewers
              });
            }
            
            // ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆåˆå›æŠ•ç¨¿è€…ã®å ´åˆï¼‰
            const { data: prsData } = await github.rest.pulls.list({
              owner,
              repo,
              creator: pr.user.login,
              state: 'all'
            });
            
            if (prsData.length === 1) {
              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number: pr.number,
                body: `ğŸ‰ @${pr.user.login} ã•ã‚“ã€åˆå›ã®PRæŠ•ç¨¿ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\n\nä»¥ä¸‹ã®ç‚¹ã‚’ã”ç¢ºèªãã ã•ã„ï¼š\n- [ ] ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨\n- [ ] ãƒªãƒ³ã‚¿ãƒ¼ãŒé€šã‚‹ã“ã¨\n- [ ] å¤‰æ›´å†…å®¹ãŒé©åˆ‡ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨\n\nãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŠå¾…ã¡ãã ã•ã„ï¼\n\n---\n\nThank you for your first PR! Please make sure:\n- [ ] Tests pass\n- [ ] Linter passes\n- [ ] Changes are properly documented\n\nWe'll review it soon!`
              });
            }
          }